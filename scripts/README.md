# Printful Product Sync Scripts

This directory contains scripts to automatically sync your Printful store data with your local codebase.

## Overview

The `printful-sync.ts` script fetches real product data from your Printful store and generates updated variant files with correct catalog variant IDs. This replaces the mock IDs with real Printful identifiers that are required for order creation.

## Prerequisites

1. **Printful API Token**: Get a private token from Printful Dashboard → Settings → API → Create Private Token
   - Scope: Read access to products (and write if you want to set external_id/SKU later)
   - Keep this token secure and never commit it to version control

2. **Store ID**: Identify your target store ID
   ```bash
   curl -H "Authorization: Bearer $PRINTFUL_TOKEN" https://api.printful.com/v2/stores
   ```

3. **Environment Setup**: Add these variables to your `.env.local` file:
   ```bash
   PRINTFUL_TOKEN=your_private_token_here
   PRINTFUL_STORE_ID=your_store_id_here
   ```

## Usage

### Run the Sync Script

```bash
# Using npm script (recommended)
npm run printful:sync

# Or directly with tsx
tsx scripts/printful-sync.ts
```

### What the Script Does

1. **Verifies Access**: Checks your token and store ID
2. **Fetches Products**: Retrieves all synced products from your store
3. **Processes Variants**: Gets variant details for each product
4. **Categorizes Products**: Automatically detects product types (tshirt, hoodie, cap, etc.)
5. **Generates Files**: Creates updated variant files with real Printful IDs
6. **Updates Pricing**: Generates pricing data from Printful retail prices

### Generated Files

The script generates these files:

- `src/hooks/tshirt-variants.ts` - T-shirt variants with real catalog variant IDs
- `src/hooks/hoodie-variants.ts` - Hoodie variants with real catalog variant IDs
- `src/hooks/cap-variants.ts` - Cap variants with real catalog variant IDs
- `src/hooks/mug-variants.ts` - Mug variants with real catalog variant IDs
- `src/hooks/totebag-variants.ts` - Tote bag variants with real catalog variant IDs
- `src/hooks/waterbottle-variants.ts` - Water bottle variants with real catalog variant IDs
- `src/hooks/mousepad-variants.ts` - Mouse pad variants with real catalog variant IDs
- `src/lib/printful/pricing-data.ts` - Pricing data for all variants

## File Structure

Each generated variant file follows this structure:

```typescript
// AUTO-GENERATED by scripts/printful-sync.ts — do not edit manually
export type TShirtVariant = {
  key: string;                    // Stable identifier (external_id, sku, or name)
  catalogVariantId: number;       // Printful catalog variant ID (use in orders)
  syncVariantId: number;          // Your store's sync variant ID
  price?: string;                 // Retail price from Printful
  name: string;                   // Variant name
  externalId?: string;            // External ID if set
  sku?: string;                   // SKU if set
};

export const TShirtVariants: TShirtVariant[] = [
  // ... variant entries
];

// Helper functions
export function findTShirtVariant(key: string): TShirtVariant | undefined;
export function findTShirtVariantByCatalogId(catalogVariantId: number): TShirtVariant | undefined;
```

## Key Concepts

### Printful IDs

- **`sync_product.id`**: Your product in your store
- **`sync_variant.id`**: Your product's variant in your store  
- **`sync_variant.variant_id`**: The Printful Catalog Variant ID (use this in orders)
- **`catalog product/variant ids`**: From Printful's catalog (read-only references)

### Why `variant_id`?

The `variant_id` is the actual Printful Catalog Variant ID required when creating orders. Using synced product data ensures you always map your frontend choices (size/color) to the correct catalog variant.

## Frontend Integration

### Before (with mock IDs)
```typescript
// Old approach - mock IDs
const variant = { printful_variant_id: 4016 }; // ❌ Mock ID
```

### After (with real IDs)
```typescript
// New approach - real Printful IDs
import { findTShirtVariant } from '@/hooks/tshirt-variants';

const variant = findTShirtVariant(`${color}-${size}`);
const lineItem = {
  variant_id: variant!.catalogVariantId,  // ✅ Real Printful catalog variant ID
  quantity: 1,
};
```

## Best Practices

### 1. Set Stable Keys
Set `external_id` or `SKU` per variant in Printful so your frontend keys are stable:

```typescript
// In Printful Dashboard or via API
external_id: "black-tshirt-s"
sku: "TSHIRT-BLK-S"
```

### 2. Regular Syncs
Run the sync script regularly to keep your variant data current:
- After adding new products
- After changing product configurations
- Before major deployments

### 3. CI Integration
Consider adding a CI check that runs the sync script in dry-run mode and fails if there are new variants that aren't committed.

### 4. Version Control
- Commit the generated variant files
- Don't edit them manually (they'll be overwritten on next sync)
- Review changes before committing

## Troubleshooting

### Common Issues

1. **Missing Token**: Ensure `PRINTFUL_TOKEN` is set in your environment
2. **Invalid Store ID**: Verify your store ID with the stores API endpoint
3. **API Rate Limits**: The script includes delays to respect API limits
4. **Network Issues**: Check your internet connection and firewall settings

### Debug Mode

The script provides detailed logging. If you encounter issues, check the console output for specific error messages.

### Manual Verification

You can manually verify the data by checking your Printful Dashboard:
- Stores → Your Store → Products
- Each product shows sync product and variant IDs
- Compare with the generated files

## Security Notes

- Never commit your `PRINTFUL_TOKEN` to version control
- Use environment variables for sensitive data
- Consider using a dedicated API token with minimal required permissions
- Rotate tokens regularly for production environments

## Support

If you encounter issues:

1. Check the console output for error messages
2. Verify your Printful API token and store ID
3. Ensure you have the required API permissions
4. Check Printful's API status and documentation

## Related Documentation

- [Printful API Documentation](https://developers.printful.com/)
- [Printful Help Center](https://help.printful.com/)
- [API Authentication Guide](https://developers.printful.com/#authentication)
