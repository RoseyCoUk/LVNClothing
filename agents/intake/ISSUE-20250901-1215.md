# Issue Intake Report: Product Page Interconnected Problems
**Date:** 2025-09-01 12:15  
**Reporter:** User Investigation Request  
**Severity:** High (Multiple product pages affected, user experience degradation)  

## Issue Summary

Investigation of four interconnected problems affecting ReformUK product pages:

1. **Image Loading Failures** - Hoodie/T-shirt pages not displaying admin-uploaded variant images
2. **Color Hex Display Problems** - Wrong color swatches on product pages despite database having correct values
3. **Size Selector Malfunction** - Hoodie page size selector not functioning properly
4. **Star Rating Inconsistency** - Different ratings between shop cards and product pages

## Evidence Gathered

### Issue 1: Image Loading Problems

**Files Analyzed:**
- `/src/components/products/HoodiePage.tsx:184-196` - Hardcoded image paths
- `/src/components/products/TShirtPage.tsx:101-120` - Static image generation
- `/src/components/products/CapPage.tsx:60` - Database-driven image array (WORKING)
- `/src/components/products/MousePadPage.tsx:99` - Database-driven approach (WORKING)

**Root Cause:** Hoodie and T-shirt pages use hardcoded static image paths instead of database-sourced images:

```typescript
// HoodiePage.tsx:184-196 - BROKEN APPROACH
const getProductImages = () => {
  const colorKey = selectedColor.replace(/\s+/g, '');
  return [
    `/Hoodie/Men/ReformMenHoodie${colorKey}1.webp`,
    // ... hardcoded paths
  ];
};

// vs CapPage.tsx:60 - WORKING APPROACH  
images: Array.from({ length: 7 }, (_, i) => `/Cap/ReformCap${variant.color.replace(/\s+/g, '')}${i + 1}.webp`)
```

**Impact:** Admin-uploaded custom images are ignored, users see outdated placeholder images.

### Issue 2: Color Hex Display Problems

**Files Analyzed:**
- `/src/hooks/useMergedProducts.ts:190-202` - Database color_hex extraction (WORKING)
- `/src/components/products/HoodiePage.tsx:371-392` - Uses database colors correctly
- `/src/components/products/TShirtPage.tsx:334-356` - Uses database colors correctly
- `/supabase/migrations/20250901100001_add_color_hex_to_variants.sql` - Schema confirmed

**Root Cause:** Investigation shows this issue may be RESOLVED - both hoodie and t-shirt pages correctly use `color.hex` from database via `useMergedProducts.colorOptions`. Cap page uses hardcoded color arrays but that's by design.

**Status:** FALSE ALARM - Color hex integration is working correctly.

### Issue 3: Size Selector Malfunction

**Files Analyzed:**
- `/src/components/products/HoodiePage.tsx:407-423` - Size selector implementation
- `/src/components/products/HoodiePage.tsx:119-124` - Availability checking logic

**Root Cause:** Size selector relies on `isSizeAvailableForColor()` function that checks:
```typescript
return hoodieProduct.variants.some(variant => 
  variant.size === sizeName && variant.color === color && variant.stock > 0
);
```

**Potential Issue:** If database variants lack proper stock values or color/size matching fails, buttons become disabled.

**Status:** NEEDS TESTING - Functionality appears correct but requires verification of database variant data integrity.

### Issue 4: Star Rating Inconsistency

**Files Analyzed:**
- `/src/components/ui/ProductCard.tsx:114-120` - Uses `product.rating` from database
- `/src/components/products/HoodiePage.tsx:345` - HARDCODED `i < 4` (shows 4-star rating)
- `/src/components/products/TShirtPage.tsx:308` - Uses `variantData.rating` (hardcoded 5)

**Root Cause Confirmed:** Different rating sources:

```typescript
// ProductCard.tsx:116 - DATABASE DRIVEN (CORRECT)
{product.rating?.toFixed(1) ?? '5.0'}

// HoodiePage.tsx:345 - HARDCODED 4-STAR (INCORRECT)
<Star className={`w-5 h-5 ${i < 4 ? 'text-yellow-400 fill-current' : 'text-gray-300'}`} />

// TShirtPage.tsx:308 - HARDCODED 5-STAR via variantData.rating=5 (INCORRECT)
<Star className={`w-5 h-5 ${i < variantData.rating ? 'text-yellow-400 fill-current' : 'text-gray-300'}`} />
```

**Impact:** Users see different ratings on shop vs product pages, damaging credibility.

## Priority Assessment

1. **Critical:** Star Rating Inconsistency - Damages user trust
2. **High:** Image Loading Problems - Admin uploads not visible 
3. **Medium:** Size Selector Issues - Requires verification
4. **Low:** Color Hex Display - Already working correctly

## Files Requiring Attention

### Primary Issues:
- `/src/components/products/HoodiePage.tsx:184-196` - Fix image loading
- `/src/components/products/HoodiePage.tsx:345` - Fix hardcoded rating
- `/src/components/products/TShirtPage.tsx:101-120` - Fix image loading  
- `/src/components/products/TShirtPage.tsx:308` - Fix hardcoded rating

### For Verification:
- Database variants stock values integrity
- Color/size matching in merged products

## Technical Notes

- `useMergedProducts` hook correctly extracts database color_hex values
- Product images should use database-sourced URLs via API priority chain
- Ratings should consistently use database `product.reviews` column
- Size availability checking logic appears sound but needs data verification